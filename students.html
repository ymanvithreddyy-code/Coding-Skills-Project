<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students - SRMS</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar & Topbar injected by script.js -->

        <main class="main-content">
            <div class="flex-between mb-4">
                <div style="display: flex; gap: 1rem; width: 100%; max-width: 600px;">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search by name or roll no...">
                    <select id="courseFilter" class="form-control" style="width: 200px;">
                        <option value="">All Courses</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <a href="add-student.html" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Student
                </a>
            </div>

            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Roll No</th>
                                <th>Name</th>
                                <th>Course</th>
                                <th>Year</th>
                                <th>Email</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                <div id="noResults" class="text-center mt-4" style="display: none; color: var(--text-secondary);">
                    No students found.
                </div>
            </div>
        </main>
    </div>

    <script src="data.js"></script>
    <script src="script.js"></script>
    <script>
        const students = DataManager.getStudents();
        const courses = DataManager.getCourses();

        // Populate Filter
        const courseFilter = document.getElementById('courseFilter');
        courses.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.name;
            opt.textContent = c.name;
            courseFilter.appendChild(opt);
        });

        function renderTable(data) {
            const tbody = document.getElementById('studentsTable');
            tbody.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('noResults').style.display = 'block';
                return;
            }
            document.getElementById('noResults').style.display = 'none';

            data.forEach(s => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${s.rollNo}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div class="admin-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">${s.name.charAt(0)}</div>
                            ${s.name}
                        </div>
                    </td>
                    <td>${s.course}</td>
                    <td>${s.year}</td>
                    <td>${s.email}</td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="profile.html?id=${s.id}" class="btn btn-outline btn-sm" title="View"><i class="fas fa-eye"></i></a>
                            <a href="edit-student.html?id=${s.id}" class="btn btn-outline btn-sm" title="Edit"><i class="fas fa-edit"></i></a>
                            <button onclick="deleteStudent('${s.id}')" class="btn btn-danger btn-sm" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initial Render
        renderTable(students);

        // Search & Filter Logic
        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedCourse = document.getElementById('courseFilter').value;

            const filtered = students.filter(s => {
                const matchesSearch = s.name.toLowerCase().includes(searchTerm) || s.rollNo.toLowerCase().includes(searchTerm);
                const matchesCourse = selectedCourse === '' || s.course === selectedCourse;
                return matchesSearch && matchesCourse;
            });

            renderTable(filtered);
        }

        document.getElementById('searchInput').addEventListener('input', filterStudents);
        document.getElementById('courseFilter').addEventListener('change', filterStudents);

        // Delete Function
        window.deleteStudent = (id) => {
            if (confirm('Are you sure you want to delete this student?')) {
                DataManager.deleteStudent(id);
                location.reload(); // Simple reload to refresh data
            }
        };
    </script>
</body>

</html>